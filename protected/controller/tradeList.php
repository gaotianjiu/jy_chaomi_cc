<?phpdate_default_timezone_set('PRC');define("web_md5", "_chaomi_cc");class tradeList extends spController{    function __construct(){        parent::__construct();		$sso_user = check();        if ($sso_user == true) {            $this->uid = $sso_user['uid'];            $this->mid = $sso_user['mid'];            check_code();        } else {            re_login();            exit();        }    }	//提交锁定域名    function locking(){		$uid = $this->uid;        $now=date("Y-m-d H:i:s");        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ip = get_client_ip();        if(is_array($id)){			$count = count($id);			//务必强制转换成数值类型---begin			foreach($id as $v){				$new_arr[]=(int)$v;			}			//务必强制转换成数值类型---end            $ids = implode(',',$new_arr);        }else{            $ids = (int)$id; //务必强制转换成数值			$count = 1;        }		if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		if($count>50)json_s(array('status'=>201,'msg'=>'每次最多可批量锁定20个域名'));				//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end			        //查询传递的id中域名状态必须是正常 即locked==0 才能锁定		$pan_domain_in = spClass('pan_domain_in');		$conditions = "uid = $uid and locked = 0 and id in(".$ids.")";        $ret_count = $pan_domain_in->findCount($conditions);		if($ret_count!=$count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'操作失败，域名状态必须是正常的才能锁定!'));		}	        //修改pan_domain_in中的状态		$row = array('locked'=>1,'upd_time'=>$now);		$ret = $pan_domain_in->update($conditions,$row);		$up_count = $pan_domain_in->affectedRows();		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存        if($ret && $up_count>=1){            //增加 操作日志            user_log($uid, 617, $ip, "【用户".$uid."】：锁定域名（编号".$ids."）域名个数：".$up_count);			json_s(array('status'=>200,'msg'=>'已成功锁定'.$up_count.'个域名'));		}else{			json_s(array('status'=>201,'msg'=>'操作域名锁定失败'));        }    }    //提交解锁域名    function unlock(){		$uid = $this->uid;        $now=date("Y-m-d H:i:s");        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ip = get_client_ip();        if(is_array($id)){			$count = count($id);			//务必强制转换成数值类型---begin			foreach($id as $v){				$new_arr[]=(int)$v;			}			//务必强制转换成数值类型---end            $ids = implode(',',$new_arr);        }else{            $ids = (int)$id; //务必强制转换成数值			$count = 1;        }		if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		if($count>50)json_s(array('status'=>201,'msg'=>'每次最多可批量解锁20个域名'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end				        //查询传递的id中域名状态必须是锁定状态 即locked==1 才能解锁		$pan_domain_in = spClass('pan_domain_in');		$conditions = "uid = $uid and locked = 1 and id in(".$ids.")";        $ret_count = $pan_domain_in->findCount($conditions);		if($ret_count!=$count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'操作失败，域名状态必须是锁定的才能解锁!'));		}	        //修改pan_domain_in中的状态		$row = array('locked'=>0,'upd_time'=>$now);		$ret = $pan_domain_in->update($conditions,$row);		$up_count = $pan_domain_in->affectedRows();		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存        if($ret && $up_count>=1){            //增加 操作日志            user_log($uid, 617, $ip, "【用户".$uid."】：解锁域名（编号".$ids."）域名个数：".$up_count);			json_s(array('status'=>200,'msg'=>'已成功解锁'.$up_count.'个域名'));		}else{			json_s(array('status'=>201,'msg'=>'操作域名解锁失败'));        }    }	//提交转出域名    function transfer(){		$uid = $this->uid;		if($uid==21836 || $uid==21841)json_s(array('status'=>201,'msg'=>'后台限制此功能'));        $now=date("Y-m-d H:i:s");        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ip = get_client_ip();        if(is_array($id)){			$count = count($id);			//务必强制转换成数值类型---begin			foreach($id as $v){				$new_arr[]=(int)$v;			}			//务必强制转换成数值类型---end            $ids = implode(',',$new_arr);        }else{            $ids = (int)$id; //务必强制转换成数值			$count = 1;        }			if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		if($count>50)json_s(array('status'=>201,'msg'=>'每次最多可批量转出50个域名')); 		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end			        $pan_domain_outplat = spClass('pan_domain_outplat');        $pan_domain_in = spClass('pan_domain_in');        //查询传递的id中域名状态必须是正常或待续费或证转出 即locked==0 or locked==3 or locked==7才能转出		$pan_domain_in = spClass('pan_domain_in');		$conditions = "uid = $uid and locked in(0,3,7) and id in(".$ids.")";        $ret_count = $pan_domain_in->findCount($conditions);		if($ret_count!=$count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'操作失败，域名状态必须是正常或待续费的才能申请转出!'));		}			$ret = $pan_domain_in->findAll($conditions);        if($ret){ 			$ids_arr = array();            $all_arr = array();            foreach($ret as $k=>$v){               $conditions = "uid = $uid and domain = '{$v['domain']}' and pingtai = '{$v['pingtai']}' and status <= 2";			   $one_outplat_count = $pan_domain_outplat->findCount($conditions);			   if($one_outplat_count>0){ //判断是否有域名已经在转出列表中					cache_a($domain_action_uid,null);//删除用户操作域名并发缓存					json_s(array('status'=>205,'msg'=>'域名：'.$v['domain'].' 当前在转出列表待处理中，请先处理。'));               }else {                    $all_arr[] = array('uid' => $v['uid'], 'domain' => $v['domain'], 'pingtai' => $v['pingtai'], 'typeid' => $v['typeid'], 'time' => $now, 'status' => 0);                    $ids_arr['id'][] = $v['id'];                    $ids_arr['domain'][] = $v['domain'];                }            } 		   if($count!=count($all_arr))json_s(array('status'=>201,'msg'=>'域名预转出个数与实际提交需转出个数不相等，请检查后重试。'));           if($all_arr){                 $pan_domain_outplat->createAll($all_arr); 			   cache_a($domain_action_uid,null);//删除用户操作域名并发缓存               if($pan_domain_outplat->affectedRows()>=1) {                      user_log($uid,619,$ip,'【用户'.$uid.'】：提交转出域名编号：('.implode(',',$ids_arr['id'])."),域名：".implode(',',$ids_arr['domain']).',已处理共'.count($all_arr).'个,预处理共'.$count.'个'); 					json_s(array('status'=>200,'msg'=>'已成功申请转出域名'.count($all_arr).'个，请到转出列表确认转出账号!'));              }else{					json_s(array('status'=>201,'msg'=>'操作域名转出失败'));			  }             }       }	   cache_a($domain_action_uid,null);//删除用户操作域名并发缓存    }    //提交续费域名    function renew(){		$uid = $this->uid;        $now=date("Y-m-d H:i:s");        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ip = get_client_ip();		if(is_array($id)){			$count = count($id);			//务必强制转换成数值类型---begin			foreach($id as $v){				$new_arr[]=(int)$v;			}			//务必强制转换成数值类型---end			$ids = implode(',',$new_arr);		}else{			$ids = (int)$id; //务必强制转换成数值			$count = 1;		}		if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		if($count>50)json_s(array('status'=>201,'msg'=>'每次最多可批量续费50个域名')); 		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end			        $pan_domain_in = spClass('pan_domain_in');        $pan_user_renew = spClass('pan_user_renew');        //查询传递的id中域名状态必须是正常或待续费 即locked==0,3 才能提交续费		$pan_domain_in = spClass('pan_domain_in');		$conditions = "uid = $uid and locked in (0,3) and id in(".$ids.")";        $ret_count = $pan_domain_in->findCount($conditions);		if($ret_count!=$count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'操作失败，域名状态必须是正常或待续费的才能申请提交续费!'));		}		$ret = $pan_domain_in->findAll($conditions);		$amount_arr = array(411104=>35,411103=>70,411102=>35,411101=>60,614101=>60,411109=>30);		$amount_pt_arr = array(411104=>array('易名中国'=>35,'爱名网'=>35,'万网'=>35),411109=>array('易名中国'=>30,'爱名网'=>53.5,'万网'=>28),614101=>array('易名中国'=>60,'爱名网'=>63,'万网'=>69));		$domain_str = "";        if($ret) {            $all_arr = array();			$d = array();            foreach($ret as $k=>$v) {                $d['typeid'] = $v['typeid'];                $d['old_pingtai'] = $v['pingtai'];                $d['domain'] = $v['domain'];                $d['domain_id'] = $v['id'];                $d['old_exptime'] = $v['expire_time'];				$d['amount'] = $amount_arr[$v['typeid']];				if($d['typeid']==411104 || $d['typeid']==411109 || $d['typeid']==614101){					$tmp_amount = $amount_pt_arr[$v['typeid']];					$d['amount'] = $tmp_amount[$v['pingtai']];				}				//临时处理 20180504				if($v['typeid']==808001 || $v['typeid']==808008 || $v['typeid']==808018){					$d['amount'] = 35;				}				if($v['typeid']==809001){					$d['amount'] = 75;				}								$d['uid'] = $uid;				$d['act_note'] = '['.$now.'前台提交续费]';				$domain_str .= $v['domain'];				if($d['amount']<=0){					cache_a($domain_action_uid,null);//删除用户操作域名并发缓存					json_s(array('status'=>205,'msg'=>'域名：'.$d['domain'].' 续费价格为0元'));									}				$conditions = array('uid'=>$uid,'domain_id'=>$d['domain_id'],'status'=>0);                $order_count = $pan_user_renew->findCount($conditions);				if($order_count>0){					cache_a($domain_action_uid,null);//删除用户操作域名并发缓存					json_s(array('status'=>205,'msg'=>'域名：'.$d['domain'].' 当前在续费列表待处理中，请先处理。'));				}else{                    $all_arr[] = $d;                }            }        }		if($count!=count($all_arr))json_s(array('status'=>201,'msg'=>'域名预续费个数与实际提交需续费个数不相等，请检查后重试。'));		if($all_arr){ 			$all_order_ret = $pan_user_renew->createAll($all_arr);			if($pan_user_renew->affectedRows()>=1){  				user_log($uid,618,$ip,"【用户" . $uid. "】提交续费订单，域名：".$domain_str.',已处理共'.count($all_arr).'个,预处理共'.$count.'个');				cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				json_s(array('status'=>200,'msg'=>'已成功申请续费域名'.count($all_arr).'个，请到续费列表确认续费并结算!'));			}else{				json_s(array('status'=>201,'msg'=>'操作域名续费失败'));			} 					}		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存    }		//转出域名列表    function outplat(){        $status = 0;		$uid = $this->uid;        $now=date("Y-m-d H:i:s");		$ip = get_client_ip();				$act = trim($this->spArgs("act"));		if($act!='list'){			$sql="select a.*,b.expire_time from pan_domain_outplat a "			." left join pan_domain_in b on a.domain=b.domain where a.uid=".$uid." and a.status=".$status." order by id desc limit 0,50";			$res=spClass('pan_domain_in')->findSql($sql);			$sql1="select group_concat(webid) as webids, group_concat(id) as ids,website from pan_member_registrar where uid=".$uid." group by website";			$res1=spClass('pan_domain_in')->findSql($sql1);			if($res1){				$webpt=array();				foreach($res1 as $k1=>$v1){					$webids = explode(',',$v1['webids']);					$bids = explode(',',$v1['ids']);					$website=getDomainSite($v1['website']);					$webpt[$k1]['pt']=$website;					foreach($webids as $key => $value){						$webpt[$k1]['ptnum'][] = array('name'=>$website.'('.$value.')','id'=>$bids[$key]);					}				}				$this->webpt=$webpt;			}			$this->result=$res;			$this->module="domainList";			$this->act="outplat_list";			$this->status=$status;			$this->display('amui/member/am_domain_outplat.html');			exit();		}		if($act=='list'){			$gb = spClass('pan_domain_outplat');			$page = intval($this->spArgs('page', 1));			if($page <1) $page=1;						$sql="select * from cmpai.pan_domain_outplat WHERE uid = $uid and status in(1,2,3,4,5) ORDER BY id DESC ";			$list=$gb->spPager($page,pgsize)->findSql($sql);			//分页开始			$pager = $gb->spPager()->getPager();			if ($pager['total_page'] > 5) {				if ($page <= 3) {					$pager['all_pages'] = array_slice($pager['all_pages'], 0, 5);				} else {					$pager['all_pages'] = array_slice($pager['all_pages'], $page - 3, 5);				}			}			$this->pager = $pager;						// dump($uid);			$this->result=$list;			$this->module="domainList";			$this->act="outplat_list";			$this->status=1;			$this->display('amui/member/am_domain_outplat_list.html');			exit();								}    }		//域名转出删除，用户待确认转出，只有状态值status=0才可删除    function delOutOrder(){		$uid = $this->uid;        $now = date("Y-m-d H:i:s");		$ip = get_client_ip();		        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));        if(is_array($id)){			$count = count($id);			//务必强制转换成数值类型---begin			foreach($id as $v){				$new_arr[]=(int)$v;			}			//务必强制转换成数值类型---end            $ids = implode(',',$new_arr);			json_s(array('status'=>201,'msg'=>'暂不支持批量删除'));        }else{            $ids = (int)$id; //务必强制转换成数值			$count = 1;        }		if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		if($count>20)json_s(array('status'=>201,'msg'=>'删除域名失败，每次最多可批量删除20条。'));			//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end							$gb = spClass('pan_domain_outplat');		//判断相关权限等---begin		$conditions = "uid = $uid and status = 0 and id in (".$ids.")";		$ret_count = $gb->findCount($conditions);		if($ret_count!=$count)json_s(array('status'=>201,'msg'=>'操作非法，权限不足或已删除'));		//判断相关权限等---end        //---改状态值---begin		$row = array('status'=>4,'deal_time'=>date("Y-m-d H:i:s"));		$ret = $gb->update($conditions,$row);        //---改状态值---end		//影响行数 $gb->affectedRows()		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存		if($ret && $gb->affectedRows()>=1){			json_s(array('status'=>200,'msg'=>'已成功移出域名转出列表'));		}else{			json_s(array('status'=>201,'msg'=>'移出转出域名列表失败'));		}		    }	//域名转出-用户取消，只有状态值status是1的才可取消    function delOut(){		$uid = $this->uid;		$ip = get_client_ip();		        $id = $this->spArgs('id');		$now = date("Y-m-d H:i:s");		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ids = (int)$id; //务必强制转换成数值				if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));			//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end					//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end					$pan_domain_outplat = spClass('pan_domain_outplat');		$pan_domain_in = spClass('pan_domain_in'); 		//判断相关权限等---begin		$conditions = "uid = $uid and status = 1 and id = $ids";		$ret_count = $pan_domain_outplat->findCount($conditions);		if($ret_count!=1)json_s(array('status'=>201,'msg'=>'操作非法，权限不足或已取消'));		//判断相关权限等---end		$conditions = "uid = $uid and status = 1 and id = $ids";		$ret = $pan_domain_outplat->find($conditions);		$domain = $ret['domain'];		$ret = $pan_domain_in->find(array('uid'=>$uid,'domain'=>$domain));		$typeid = $ret['typeid'];		if(!$domain)json_s(array('status'=>201,'msg'=>'域名：'.$domain.'状态不是在转出中，无法取消!'));        //判断域名相关状态等---begin		//-----20170720-----修改------如果是证的域名在转出，locked=7状态，如果用户取消了必须要将locked更新回=7		// locked = 4 locked = 7		$conditions = "uid = $uid and domain = '".$domain."'";//状态：转出中，才可取消		$pan_in_ret = $pan_domain_in->find($conditions);		$locked = 0; //默认是更新回正常		if($pan_in_ret['locked']==7)$locked = 7; //****注意：如果是“证转出”状态下，即locked=7时，必须更新回locked=7		if($pan_in_ret['locked']==4 || $pan_in_ret['locked']==7){		}else{			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'域名：'.$domain.'状态不是在转出中，已无法取消。如需帮助请联系客服。'));		}        //判断域名相关状态等---end	        //修改转出表的状态         //---改状态值---begin		$row = array('status'=>4,'deal_time'=>$now);		$conditions = "uid = $uid and status = 1 and id = $ids";		$ret = $pan_domain_outplat->update($conditions,$row);		$outplat_affectedRows = $pan_domain_outplat->affectedRows();        //---改状态值---end        //修改用户域名表的状态 		$conditions = "uid = $uid and locked in(4,7) and domain = '".$domain."'";		$row = array('locked'=>$locked,'upd_time'=>$now); //修改为正常		$ret = $pan_domain_in->update($conditions,$row);		$pan_affectedRows = $pan_domain_in->affectedRows(); //影响行数		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存		if($ret && $outplat_affectedRows == $pan_affectedRows){			user_log($uid,619,$ip,'【用户'.$uid.'】:成功取消转出域名：'.$domain.'共1个,已处理共(影响行数)'.$pan_affectedRows.'个');			json_s(array('status'=>200,'msg'=>'已成功取消转出'));		}else{			json_s(array('status'=>201,'msg'=>'取消转出失败'));		}		    }		//批量确认转出域名    function outplat_post(){		$pan_domain_in = spClass('pan_domain_in'); 		$pan_domain_outplat = spClass('pan_domain_outplat'); 		$pan_member_registrar = spClass('pan_member_registrar'); 		$uid = $this->uid;		if($uid==21836 || $uid==21841)json_s(array('status'=>201,'msg'=>'后台限制此功能'));        $pt = $this->spArgs('pt');        $domain = $this->spArgs('domain');		if(!$domain || empty($domain) || !$pt || empty($pt))json_s(array('status'=>201,'msg'=>'参数不能为空'));        $safecode = $this->spArgs('safecode');        $now = date("Y-m-d H:i:s");		$ip = get_client_ip();			//------------限制相同IP并发请求----------begin		$ip_key = md5($ip);		$key_name = 'outplat_post_ip_'.$ip_key;		if(false === cache_a($key_name,time(),1))json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙请稍后1秒后重试!'));			//------------限制相同IP并发请求----------end					//------------限制帐号请求次数----------begin		$key_name = 'outplat_post_uid_'.$uid;		if(cache_s($key_name)>20)json_s(array('status'=>205,'msg'=>'很抱歉，请求次数限制，请稍后1小时后再操作'));						cache_s($key_name,intval(cache_s($key_name))+1,3600);		//------------限制帐号请求次数----------end						//----判断安全码是否正确---begin		$safecode = trim($this->spArgs("safecode"));		if(empty($safecode))json_s(array('status'=>203,'msg'=>'请输入帐号安全码'));		$safecode = md5(md5($safecode . web_md5)); //双重md5加密		$gb_safe = spClass('pan_user_safecode');		$conditions = array("uid" => $uid);		$r = $gb_safe->find($conditions);		if($r['safecode'] != $safecode)json_s(array('status'=>203,'msg'=>'安全码错误，请输入正确的帐号安全码'));		cache_s($key_name,null);		//----判断安全码是否正确---end		//判断是否是数组，再过滤下防注入等---begin        if(is_array($domain)){			$domain_count = count($domain);			$pt_count = count($pt);			$domain_arr = array();			$pt_arr = array();			foreach($domain as $v){				$domain_arr[] = $pan_domain_in->escape(str_replace('_','.',$v));				}            $domain_ids = implode(',',$domain_arr);			foreach($pt as $v){					//提交的域名注册商帐号权限判断---begin					$conditions = array('uid'=>$uid,'id'=>$v);					$pt_ret = $pan_member_registrar->find($conditions);					if($pt_ret['website']=='')json_s(array('status'=>201,'msg'=>'提示：请选择正确转出平台/帐号ID，如没有添加绑定，请先绑定你的注册商帐号ID。'));					//提交的域名注册商帐号权限判断---end								$pt_arr[] = array('website'=>getDomainSite($pt_ret['website']),'webid'=>$pt_ret['webid']);					$pt_name_arr[] = getDomainSite($pt_ret['website']).'('.$pt_ret['webid'].')';				}			        }else{            $domain_ids = $pan_domain_in->escape($domain);				//提交的域名注册商帐号权限判断---begin				$conditions = array('uid'=>$uid,'id'=>$pt);				$pt_ret = $pan_member_registrar->find($conditions);				if($pt_ret['website']=='')json_s(array('status'=>201,'msg'=>'提示：请选择正确转出平台/帐号ID，如没有添加绑定，请先绑定你的注册商帐号ID。'));				//提交的域名注册商帐号权限判断---end								$pt_arr[] = array('website'=>getDomainSite($pt_ret['website']),'webid'=>$pt_ret['webid']);						$pt_name_arr[] = getDomainSite($pt_ret['website']).'('.$pt_ret['webid'].')';							$domain_count = 1;			$pt_count = 1;			$domain_arr[] = (int)$domain;        }		//判断是否是数组，再过滤下防注入等---end		if(!$domain_ids)json_s(array('status'=>201,'msg'=>'域名参数不能为空'));		if($pt_count<=0)json_s(array('status'=>201,'msg'=>'注册商平台帐号ID参数不能为空'));		if($domain_count>50)json_s(array('status'=>201,'msg'=>'提示：目前每次最多可批量提交转出50条。'));		if($domain_count != $pt_count)json_s(array('status'=>201,'msg'=>'提示：转出域名数量与注册商帐号异常，请检查核对正确。'));				//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end							//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end								        //提交的域名和数据表中的数据进行比对---begin		$conditions = "uid = $uid and locked in(0,3,7) and domain in (".$domain_ids.")";//状态：正常或待续费中或证转出，才可转出		$pan_in_count = $pan_domain_in->findCount($conditions);		$conditions = "uid = $uid and status=0 and domain in (".$domain_ids.")";//状态：未处理		$pan_outplat_count = $pan_domain_outplat->findCount($conditions);		if($pan_in_count!=$pan_outplat_count || $pan_in_count!=$domain_count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'请检查需要转出的域名状态是否锁定或出售中？需转出域名数量:'.$domain_count.'转出域名数量:'.$pan_in_count.' 待转出域名数量:'.$pan_outplat_count.' 提示：转出域名数量与待转出域名数量不相等，如需帮助请联系客服。'));		}		if($pan_in_count==0 || $pan_outplat_count==0){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'提示：操作非法!'));		}        //提交的域名和数据表中的数据进行比对---end		$sp = spClass('pan_domain_in');		$sql_sw = false;		$sp->runSql("SET AUTOCOMMIT=0");		$sp->runSql('BEGIN'); //开启事务					$v_affectedRows = 0;		$v_locked_7_domain = "";		foreach ($domain_arr as $k1 => $v1){			$v1_ = str_replace("'",'',$v1);			$conditions = array('uid'=>$uid,'domain'=>$v1_,'status'=>0);			$ret = $pan_domain_outplat->find($conditions);			if($ret['pingtai']!=$pt_arr[$k1]['website']){				cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				json_s(array('status'=>201,'msg'=>'提示：域名 '.$v1_.' 注册商帐号异常，请检查核对正确。'));			}						//20170720修改---，正常的转出与证转出，要区别开。简单处理			$domain = $v1_;			$v_domain = $pan_domain_in->find(array('uid'=>$uid,'domain'=>$domain));			if($v_domain['locked']==0 || $v_domain['locked']==3){				//修改用户域名表的状态 				//处理正常的域名转出，即locked=0的域名				//locked更新为4				$pan_domain_in->update(array('uid'=>$uid,'domain'=>$domain,'locked'=>$v_domain['locked']),array('locked'=>4,'upd_time'=>$now));				$v_affectedRows = $v_affectedRows + $pan_domain_in->affectedRows();			}			if($v_domain['locked']==7){				//修改用户域名表的状态 				//处理“证转出”的域名转出，即locked=7的域名				//locked要保持不变				$pan_domain_in->update(array('uid'=>$uid,'domain'=>$domain,'locked'=>7),array('locked'=>7,'upd_time'=>$now));				$v_affectedRows = $v_affectedRows + $pan_domain_in->affectedRows();				$v_locked_7_domain .= $domain.',';			}					}        //处理转出申请         //修改转出表的状态         //修改用户域名表的状态		//20170720修改---，正常的转出与证转出，要区别开。简单处理		// $conditions = "uid = $uid and domain in (".$domain_ids.")";//状态：正常或待续费中，才可转出		// $row = array('locked'=>4,'upd_time'=>$now);		// $ret = $pan_domain_in->update($conditions,$row);		if($v_affectedRows!=$domain_count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'更新域名状态与实际数据不符，事务已回滚。'));		}			if(count(array_unique($pt_name_arr))>1) { 			foreach ($domain_arr as $k1 => $v1) { 				$conditions = "uid = $uid and status = 0 and domain in(".$v1.")";				$row = array('status'=>1,'domain_website'=>$pt_name_arr[$k1],'deal_time'=>$now);				$pan_domain_outplat->update($conditions,$row);			}		}else {			$conditions = "uid = $uid and status = 0 and domain in (".$domain_ids.")";			$row = array('status'=>1,'domain_website'=>$pt_name_arr[0],'deal_time'=>$now);			$pan_domain_outplat->update($conditions,$row);		}		user_log($uid,619,$ip,'【用户'.$uid.'】:确认转出域名：'.$domain_ids.'共'.$domain_count.'个。'.',已处理共(影响行数)'.$v_affectedRows.'个,预处理共'.$domain_count.'个,其中可能包含证转出域名：'.$v_locked_7_domain);		//----邮件后台提醒----begin			$content = array();			$content['to'] = array('pwpet@qq.com');			$content['sub'] = array('%content%'=>array('用户MID：'.$this->mid.'，提交了域名转出申请，转出域名数量'.$domain_count.'个'));			$new_content = json_encode($content);			send_mail('pwpet@qq.com','【炒米后台提醒】有用户提交域名转出！',$new_content,8);			$content['to'] = array('605466504@qq.com');			$new_content = json_encode($content);			send_mail('605466504@qq.com','【炒米后台提醒】有用户提交域名转出！',$new_content,8);									//----邮件后台提醒----end				$sql_sw = true;		if(false===$sql_sw){			$sp->runSql('ROLLBACK'); //回滚事务			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'系统处理出错，已回滚事务。'));						}else{			$sp->runSql('COMMIT'); //提交事务			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				json_s(array('status'=>200,'msg'=>'已成功确认处理转出域名'.$domain_count.'个，待审核中'));		}		    }    //批量确认续费-最后一步    function renew_post(){        $uid=$this->uid;        $id=$this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));        $now=date("Y-m-d H:i:s");        $ip=get_client_ip();		//------------限制相同IP并发请求----------begin		$ip_key = md5($ip);		$key_name = 'renew_post_ip_'.$ip_key;		if(false === cache_a($key_name,time(),1))json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙请稍后1秒后重试!'));			//------------限制相同IP并发请求----------end					//------------限制帐号请求次数----------begin		$key_name = 'renew_post_uid_'.$uid;		if(cache_s($key_name)>20)json_s(array('status'=>205,'msg'=>'很抱歉，请求次数限制，请稍后1小时后再操作'));						cache_s($key_name,intval(cache_s($key_name))+1,3600);		//------------限制帐号请求次数----------end					//----判断安全码是否正确---begin		$safecode = trim($this->spArgs("safecode"));		if(empty($safecode))json_s(array('status'=>203,'msg'=>'请输入帐号安全码'));		$safecode = md5(md5($safecode . web_md5)); //双重md5加密		$gb_safe = spClass('pan_user_safecode');		$conditions = array("uid" => $uid);		$r = $gb_safe->find($conditions);		if($r['safecode'] != $safecode)json_s(array('status'=>203,'msg'=>'安全码错误，请输入正确的帐号安全码'));		cache_s($key_name,null);		//----判断安全码是否正确---end			        $y=date("Y",$now);        $m=date("m",$now);        $d=date("d",$now);		//判断是否是数组，再过滤下防注入等---begin        if(is_array($id)){			$ids_count = count($id);			$ids_arr = array();			foreach($id as $v){				$ids_arr[] = (int)$v;				}            $ids = implode(',',$ids_arr);			        }else{            $ids = (int)$id;						$ids_count = 1;			$ids_arr[] = (int)$id;        }		//判断是否是数组，再过滤下防注入等---end				if($ids_count<=0)json_s(array('status'=>201,'msg'=>'域名参数不能为空'));		if($ids_count>100)json_s(array('status'=>201,'msg'=>'提示：目前每次最多可批量续费100个域名'));		if($ids_count!=count($ids_arr))json_s(array('status'=>201,'msg'=>'提示：结算续费域名数量错误!'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end							//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end					$pan_domain_in = spClass('pan_domain_in'); 		$pan_user_renew = spClass('pan_user_renew');         //提交的订单ID和数据表中的数据进行比对---begin		$conditions = "uid = $uid and status=0 and id in (".$ids.")";//状态：未处理的续费订单		$order_count = $pan_user_renew->findCount($conditions);		if($ids_count!=$order_count){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'提示：需续费的订单数量异常，权限不足或已续费，请刷新重试!'));		}        //提交的订单ID和数据表中的数据进行比对---end        $totPrice=0.00;        if(!empty($ids_arr)) {            $domain_id_arr = array();   //需要修改的域名id            $domain_arr = array();   //需要修改的域名            foreach ($ids_arr as $k => $v) {				//----通过查订单ID，取出域名---begin				$conditions = array('uid'=>$uid,'id'=>$v);				$r = $pan_user_renew->find($conditions);				$totPrice += $r['amount'];//单价相加取得需要扣除的总价				$domain = $r['domain'];				$old_pingtai =  $r['old_pingtai'];				$old_exptime =  $r['old_exptime'];				if(!$domain)json_s(array('status'=>201,'msg'=>'提示：续费单号'.$v.'，对应的域名不存在，请检查'));				//判断是否已经在后台待处理状态？				if($r['status_1']==0 && $r['status']==1){					json_s(array('status'=>201,'msg'=>'提示：域名'.$domain.'，在续费中，暂不能继续提交续费申请。'));				}				//----通过查订单ID，取出域名---end				$r = array();                $r = $pan_domain_in->find(array('uid'=>$uid,'domain'=>$domain));				if($r['locked']==0 || $r['locked']==3){				}else{					json_s(array('status'=>201,'msg'=>'提示：域名'.$domain.' 当前状态异常，请刷新重试!'));				}				if($r['expire_time']!=$old_exptime)json_s(array('status'=>201,'msg'=>'提示：域名'.$domain.' 可能已续费成功或其它错误，请刷新重试!'));                $pt = $r['pingtai'];                $domain_id_arr[] = $r['id'];                $domain_arr_[] = "'".$r['domain']."'";                $domain_arr[] = $r['domain'];				if($old_pingtai != $pt)json_s(array('status'=>201,'msg'=>'提示：域名'.$domain.' 所在注册商平台信息异常，请刷新重新!'));            }			if(count($domain_id_arr) != count($domain_arr) || !$domain_id_arr || $totPrice==0)json_s(array('status'=>201,'msg'=>'提示：域名续费信息数据异常，请刷新重试!'));            $domains = implode(',', $domain_arr);            $domains_ = implode(',', $domain_arr_);            $domains_id = implode(',', $domain_id_arr);            //生成订单号，YmdHis+uid+一个随机数            $order_id = 'UXF'.date("YmdHis", $now).$uid.mt_rand(100000, 999999);            //从账户扣钱            //修改续费订单            //修改域名到期时间和状态            //增加流水记录            //增加操作日志记录            //切换数据库            $sp = spClass('lib_member_account');			$sql_sw = false;			$sp->runSql("SET AUTOCOMMIT=0");			$sp->runSql('BEGIN');//开启事务					            $lib = spClass('lib_member_account');            $account_sql = "select balance,freeze_money from ykjhqcom.lib_member_account where uid = $uid FOR UPDATE";            $res = $lib->findSql($account_sql);            $balance = $res[0]['balance'];            $freeze_money=$res[0]['freeze_money'];			$rest = $balance - $freeze_money - $totPrice;			if ($rest >= 0) {				//资金够续费				$balance = $balance - $totPrice;  //续费总额				//更新用户资产表				$sql = "update ykjhqcom.lib_member_account set balance=$balance,update_time='{$now}' where uid = ".$uid;				$lib->runSql($sql);				//财务变化流水表   ----用户消费（续费）				$amount = 0 - $totPrice;				$brow = array('uid' => $uid, 'order_id' => $order_id, 'type' => 500, 'amount' => $amount, 'ip' => $ip, 'deal_time' => time(), 'note' => '续费域名'.$ids_count.'个，扣除金额' . $totPrice . '元', 'balance' => $balance, 'y' => $y, 'm' => $m, 'd' => $d);				spClass('lib_member_records')->create($brow);				user_log($uid, 618, $ip, "【用户" .$uid."】：续费域名（".$domains.'），编号（'.implode(',', $domain_id_arr).'），扣除金额'.$totPrice .'元，剩余总余额'. $balance .'元。执行前查总余额'.$res[0]['balance'].'元->执行此条时总余额'.$balance.'元');			} else {				//资金不够续费				cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				json_s(array('status'=>203,'msg'=>'抱歉，您账户可用余额不足扣除此次续费金额('.$totPrice.'元)，请先充值！'));			}			            //修改续费订单状态            $conditions = "uid = $uid and status=0 and id in($ids)";			$pan_user_renew->update($conditions,array('status'=>1,'pay_time'=>$now));			if($pan_user_renew->affectedRows()!=count($ids_arr)){				cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				json_s(array('status'=>203,'msg'=>'更新续费订单数据与实际不符!'));							}            user_log($uid,618,$ip,"[用户".$uid."]：更新完成了续费订单(编号：".$ids.")");            $s_sql = "select id,domain,expire_time from cmpai.pan_domain_in where uid = $uid and locked in (0,3) and id in(".implode(',',$domain_id_arr).")";            $s_res = $pan_domain_in->findSql($s_sql);            if ($s_res !== false) {				$to_affectedRows = 0;                foreach ($s_res as $k => $v) {					$new_time = date("Y-m-d", strtotime("+1 year", strtotime($v['expire_time']))); //时间增加了一年					$row = array('locked'=>0,'expire_time'=>$new_time,'upd_time'=>$now);                    // $a = $pan_domain_in->update(array('uid'=>$uid,'id'=>$v['id'],'domain'=>$v['domain']),$row);                    $a = $pan_domain_in->update("uid=$uid and id=".$v['id']." and domain='".$v['domain']."' and locked in (0,3)",$row);					$pan_affectedRows = $pan_domain_in->affectedRows(); //影响行数					$to_affectedRows += $pan_affectedRows;					user_log($uid, 618, $ip, "【用户" .$uid. "】：续费域名编号：" .$v['id']. "，域名：".$v['domain']."，时间增加了一年。原时间：".$v['expire_time'].'->新时间'.$new_time);                }               if(count($s_res)!=$to_affectedRows){				   //更新行数跟预更新行数不一致!!!!					cache_a($domain_action_uid,null);//删除用户操作域名并发缓存					$sp->runSql('ROLLBACK'); //回滚事务					write('用户UID：'.$uid.' 续费域名订单号：'.$ids.' 出错，事务回滚!!!');					json_s(array('status'=>203,'msg'=>'抱歉，系统处理出错[更新不符]，请稍候重试。'));								   }else{					//---添加站内信---begin					$type =  '901';					$tit  =  '恭喜，已成功续费'.$to_affectedRows.'个域名!';					$txt  =  '本次共续费'.$to_affectedRows.'个域名，续费一年，域名：'.implode(',',$domain_arr).'，共扣除金额：'.$totPrice.'元。';					web_msg_send($tit,$type,$uid,$txt);						send_mobile_email($uid,'炒米网(chaomi.cc)域名续费成功通知','已成功续费'.$to_affectedRows.'个域名，共扣除金额'.$totPrice.'元。');					//---添加站内信---end						//----邮件后台提醒----begin						$content = array();						$content['to'] = array('pwpet@qq.com');						$content['sub'] = array('%content%'=>array('用户MID：'.$this->mid.'，提交了域名续费，域名数量：'.$to_affectedRows.'个，已扣除当前用户金额：'.$totPrice.'元'));						$new_content = json_encode($content);						send_mail('pwpet@qq.com','【炒米后台提醒】有用户提交域名续费！',$new_content,8);						$content['to'] = array('605466504@qq.com');						$new_content = json_encode($content);						send_mail('605466504@qq.com','【炒米后台提醒】有用户提交域名续费！',$new_content,8);												//----邮件后台提醒----end									   $sp->runSql('COMMIT');//执行事务				   write('用户UID：'.$uid.' 成功续费'.$to_affectedRows.'个域名，已扣除金额'.$totPrice.'元，当前余额'.$balance.'元，续费订单号：'.$ids.'，域名ID：'.implode(',', $domain_id_arr).'，域名：'.$domains);				   cache_a($domain_action_uid,null);//删除用户操作域名并发缓存				   json_s(array('status'=>200,'msg'=>'恭喜，已成功续费'.$to_affectedRows.'个域名，共扣除金额'.$totPrice.'元，当前余额'.$balance.'元'));			   }            }        }		json_s(array('status'=>201,'msg'=>'处理数据出错!'));    }    //续费购物车    function shopcart(){		$uid = $this->uid;		$pan_user_renew = spClass('pan_user_renew');		$act = trim($this->spArgs("act"));		if($act!='list'){			$ret = $pan_user_renew->findAll(array('uid'=>$uid,'status'=>0),'id desc');			$result=array();			$totPrice = 0;			if ($ret){				foreach ($ret as $k => $v) {					$types = check_pz($v['typeid']);					$v['name'] = $types[0]['name']; //品种名字						$result[]= $v;					$totPrice += $v['amount'];				}			}			$this->totPrice=$totPrice;			$this->totCount=count($ret);			$this->result=$result;			$this->module="capital";			$this->act="shopcart";			$this->display('amui/member/am_financial_shopcart.html');			exit();		}				if($act=='list'){			$page = intval($this->spArgs('page', 1));			if($page <1) $page=1;						$sql="select * from cmpai.pan_user_renew WHERE uid = $uid and status in(-1,1) ORDER BY update_time DESC ";			$list=$pan_user_renew->spPager($page,pgsize)->findSql($sql);			$result=array();			if ($list){				foreach ($list as $k => $v) {					$types = check_pz($v['typeid']);					$v['name'] = $types[0]['name']; //品种名字						$result[]= $v;				}			}						//分页开始			$pager = $pan_user_renew->spPager()->getPager();			if ($pager['total_page'] > 5) {				if ($page <= 3) {					$pager['all_pages'] = array_slice($pager['all_pages'], 0, 5);				} else {					$pager['all_pages'] = array_slice($pager['all_pages'], $page - 3, 5);				}			}			$this->pager = $pager;						$this->result=$result;			$this->module="capital";			$this->act="shopcart";			$this->status=1;			$this->display('amui/member/am_financial_shopcart_list.html');			exit();								}		    }    //删除续费订单    function delOrder(){		$uid = $this->uid;        $id = $this->spArgs('id');		if(!$id || empty($id))json_s(array('status'=>201,'msg'=>'参数ID不能为空'));		$ids = (int)$id; //务必强制转换成数值		if(!$ids)json_s(array('status'=>201,'msg'=>'参数ID不能为空'));				//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------begin		$domain_action = 'domain_action';		cache_a($domain_action,'user',5);		if(cache_a($domain_action)=='system')json_s(array('status'=>205,'msg'=>'很抱歉，系统繁忙，请稍后刷新重试。'));		//------------限制系统全部用户请求操作域名相关---判断后台是否在处理操作待续费、待下架----------end							//------------限制用户并发请求操作域名相关----------begin		$domain_action_uid = 'domain_action_uid_'.$uid;		if(false === cache_a($domain_action_uid,time(),10))json_s(array('status'=>205,'msg'=>'很抱歉，系统队列繁忙，请稍后刷新重试。'));			//------------限制用户并发请求操作域名相关----------end					$pan_user_renew = spClass('pan_user_renew');		//判断相关权限等---begin		$conditions = array('uid'=>$uid,'status'=>0,'id'=>$ids);		$ret = $pan_user_renew->find($conditions);		if(!$ret){			cache_a($domain_action_uid,null);//删除用户操作域名并发缓存			json_s(array('status'=>201,'msg'=>'操作非法，权限不足或已续费'));		}			//判断相关权限等---end        //---改状态值---begin		$row=array('status'=>-1,'act_note'=>$ret['act_note'].'['.date("Y-m-d H:i:s").'删除续费申请]');		$ret = $pan_user_renew->update($conditions,$row);        //---改状态值---end		//影响行数 $pan_user_renew->affectedRows()		cache_a($domain_action_uid,null);//删除用户操作域名并发缓存		if($ret && $pan_user_renew->affectedRows()>=1){			json_s(array('status'=>200,'msg'=>'已成功移出域名续费列表'));		}else{			json_s(array('status'=>201,'msg'=>'移出域名续费列表失败'));		}    }}